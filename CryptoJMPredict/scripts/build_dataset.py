# -*- coding: utf-8 -*-
"""build_dataset

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1K6M5QMM6lYCPtTqt7RMBTlb40fOYKRee
"""

import pandas as pd

def consolidar_dados():
    print("\n--- 2. CONSOLIDANDO DATASET MESTRE (BUILD DATASET) ---")

    try:
        # 1. Carregar Mercado (Preço + Features Técnicas)
        df_mercado = pd.read_csv('bitcoin_features_v2.csv', sep=';', decimal=',')

        # 2. Carregar Sentimento (O que acabamos de criar)
        df_sentimento = pd.read_csv('sentimento_diario.csv', sep=';')

    except FileNotFoundError as e:
        print(f"Erro Crítico: Faltam arquivos. {e}")
        return

    # Padronizar datas para datetime
    df_mercado['Data'] = pd.to_datetime(df_mercado['Data'])
    df_sentimento['Data'] = pd.to_datetime(df_sentimento['Data'])

    print(f"Mercado: {len(df_mercado)} linhas | Sentimento: {len(df_sentimento)} dias")

    # 3. A GRANDE FUSÃO (MERGE)
    # Usamos 'left' para manter TODOS os dias de mercado, mesmo que não tenha notícia
    df_final = pd.merge(df_mercado, df_sentimento, on='Data', how='left')

    # 4. Tratamento de Vazios
    # Se um dia não teve notícia, o sentimento fica NaN. Vamos assumir 0 (Neutro).
    df_final['Sentimento_Medio'] = df_final['Sentimento_Medio'].fillna(0)

    # Organizar: Data como índice
    df_final.set_index('Data', inplace=True)
    df_final.sort_index(inplace=True)

    # Salvar o ARQUIVO FINAL para a IA
    df_final.to_csv('dataset_consolidado.csv', sep=';', decimal=',')

    print("--- FUSÃO CONCLUÍDA ---")
    print("Arquivo salvo: 'dataset_consolidado.csv'")
    print(df_final.head())
    print("\nColunas prontas para a IA:", df_final.columns.tolist())

if __name__ == "__main__":
    consolidar_dados()